<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="author" content="Marcello Arcangeli" />
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
		<link rel="stylesheet" href="css/leaflet.elevation-0.0.4.css" />
		<link rel="stylesheet" href="css/leaflet-panel-layers.css" />
		<link rel="stylesheet" href="css/icons.css" />
		<link rel="stylesheet" href="css/style.css" />
	    <script src="js/leaflet.js"></script>
		<script type="text/javascript" src="js/leaflet.elevation-0.0.4.min.js"></script>
		<script src="js/gpx.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
<!--		<script src="js/L.Control.Locate.min.js"></script> -->
        <script src="js/Autolinker.min.js"></script>
        <script src="js/leaflet-panel-layers.min.js"></script>
        <script src="js/eventr.min.js"></script>
		<!-- GEOJSON DATA -->
		<script src="data/mangiare.js"></script>
		<script src="data/dormire_1.js"></script>
		<script src="data/comprare_2.js"></script>
        <script src="data/38TourdellAmerino.js"></script>
        <script src="data/37SentierodiSBrunone.js"></script>
        <script src="data/36SentierodiPiandellaSelva.js"></script>
        <script src="data/35SentierodellaGrottadelVento.js"></script>
        <script src="data/34LugnanoRamici.js"></script>
        <script src="data/33SentierodiPalliccio.js"></script>
        <script src="data/32AnelloSambucetoleSismano.js"></script>
        <script src="data/31PennaVallicelle.js"></script>
        <script src="data/30PennaSolfatara.js"></script>
        <script src="data/29TrekkingUrbanoAmelia2017.js"></script>
        <script src="data/28PasseggiatadellaCavallerizza.js"></script>
        <script src="data/27PasseggiataAmeriantrail.js"></script>
        <script src="data/26AnelloMacchiePiandiNappa.js"></script>
        <script src="data/25GrandeAnelloAmerino.js"></script>
        <script src="data/24AnellodelRioGrande.js"></script>
        <script src="data/23AnelloMacchieRoccoBasso.js"></script>
        <script src="data/22AnellodellaCavallerizza.js"></script>
        <script src="data/21AnelloLagoVecchioLaCavallerizza.js"></script>
        <script src="data/20GirodelleFrazioni.js"></script>
        <script src="data/19GirodeiColliAmerini.js"></script>
        <script src="data/18GirodeiBoschiAmerini.js"></script>
        <script src="data/17AnelloAmeliaAspreta.js"></script>
        <script src="data/16AnelloCollicelloCapodiSopra.js"></script>
        <script src="data/15AnelloCavallerizzaRoccoBasso.js"></script>
        <script src="data/14AnelloSantaRestitutaMontePianicelGrande.js"></script>
        <script src="data/13AnelloMacchieSantaRestituta.js"></script>
        <script src="data/12AnelloMacchieFelceto.js"></script>
        <script src="data/11AnellodiMontecchio.js"></script>
        <script src="data/10AnellodiMelezzole.js"></script>
        <script src="data/9AnellolungodiFarnetta.js"></script>
        <script src="data/8AnellocortodiFarnetta.js"></script>
        <script src="data/7AnellolungodiCollicello.js"></script>
        <script src="data/6AnelloAlvianoGuardea.js"></script>
        <script src="data/5GirodelParcoEnergiaRinnovabile.js"></script>
        <script src="data/4GiroCavallerizzaMassano.js"></script>
        <script src="data/3AnelloAlvianoMadonnadelPorto.js"></script>
        <script src="data/2AmerianTrail2017.js"></script>
        <script src="data/1AmeliaSantaMaddalena.js"></script>
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title>Sentieri Amerini</title>
    </head>

    <body>
        <div id="map">
        </div>

		<div id="feature_infos">
		 <span id="info"></span>
		</div>

   <script>
        var map = L.map('map', {
            zoomControl:true, maxZoom:21, minZoom:11
        }).fitBounds([[42.10,11.945],[43.05,12.78]]);
        var hash = new L.Hash(map);
        map.attributionControl.addAttribution;
        var basemap0 = L.tileLayer('http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey=9a0f6bee78fe4b999bd2dea060084527', {
            attribution: ' <a href="http://labs.easyblog.it/maps/leaflet-panel-layers/">PanelLayers</a> | Map tiles @ <a href="http://www.thunderforest.com">Thunderforest</a>, <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
            maxZoom: 21
        });
/*        L.control.locate().addTo(map); */
		L.control.scale().addTo(map);
        basemap0.addTo(map);
		osmLayer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: ' <a href="http://labs.easyblog.it/maps/leaflet-panel-layers/">PanelLayers</a> | <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
            maxZoom: 19
        });
        
		map.createPane('elevazione');
		var el = L.control.elevation({
			pane: 'elevazione',
			collapsed: true,
		});

        function setBounds() {
            map.setMaxBounds(map.getBounds());
        }

        function style_percorsi() {
            return {
                opacity: 1,
                color: 'rgba(31,120,180,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 6.0,
                fillOpacity: 0,
            }
        }

        function highlightFeature(e) {
            highlightLayer = e.target;

/* Check if just selected layers from panelLayers, in that case the first click is missed,
   so this check will simulate a mouse click on map */
            if (document.activeElement.id !== "map") {
				document.getElementById('map').focus();
				Eventr.simulate(document.getElementById('map'),'click');
			}
// Check if the feature is a route, in that case when highlighted is showed a popup with name
            if (e.target.feature.geometry.type === 'LineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
				var popup_info = "<nobr><b>" + e.target.feature.properties.name + "</b></nobr>";
				highlightLayer.bindPopup(popup_info, {closeButton: false}).openPopup();
            }
        };

		function close_info() {
							feature_infos.style.display= "none";
							document.getElementById("info").innerHTML = "";
						};

        function selectFeature(e) {
			selectLayer = e.target;
			if (e.target.feature.geometry.type === 'LineString') {
				map.fitBounds(selectLayer.getBounds());

				el.addTo(map);
				for (var i = 0; i < 38; i++) {
						if ((overLayers[1].layers[i].name != e.target.feature.properties.name) && (map.hasLayer(overLayers[1].layers[i].layer))) {
							map.removeLayer(overLayers[1].layers[i].layer);
						};
					};

				el.clear();
				var g=new L.GPX(e.target.feature.properties['gpx'], {async: true});
				g.on('loaded', function(e) {
					map.fitBounds(e.target.getBounds());
				});
				g.on("addline",function(e){
					el.addData(e.line);
				});

				var popup_info = "<img src='" + e.target.feature.properties.image + "' width='99%' height='75%'>" +
					"<nobr><b>" + e.target.feature.properties.name + "</b></nobr><br>" +
					(e.target.feature.properties['info-de'] != '' ? ('<a href="' + e.target.feature.properties['info-de'] + '" target="_blank">Mehr Infos</a>') : '') +
					"<img src='images/cancel_@2X.png' align='right' onclick='close_info()'>" +             
					(e.target.feature.properties['gpx'] != '' ? ('<br><a href="' + e.target.feature.properties['gpx'] + '" download>Download gpx</a>') : '');             
					feature_infos.style.display= "flex";
		            document.getElementById("info").innerHTML = popup_info;
				}
				else if (e.target.feature.geometry.type === 'Point') {
					selectLayer.unbindPopup();
					var pos = new Array(2);
					pos = (e.target.feature.geometry.coordinates);
					map.setView({lat: pos[1], lon: pos[0]}, 14);
					var popup_info = "<nobr><b>" + e.target.feature.properties.name + "</b></nobr><br>" + 
					(e.target.feature.properties['phone'] != null ? (e.target.feature.properties['phone']) : '') + "<br></nobr>" + 
					(e.target.feature.properties['email'] != null ? Autolinker.link(String(e.target.feature.properties['email'])) : '') + "<br>" + 
					(e.target.feature.properties['website'] != null ? Autolinker.link(String(e.target.feature.properties['website'])) : '') + "<br>" +
					(e.target.feature.properties['info-de'] != '' ? ('<a href="' + e.target.feature.properties['info-de'] + '" target="_blank">Mehr Infos</a>') : '');
						selectLayer.bindPopup(popup_info, {autoPan: false}).openPopup();
				}
				else {
				var popup_info = null;
			};
		};

function layer_events(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
                click: selectFeature
            });
	};

        function iconByName(name) {
			return '<i class="icon icon-'+name+'"></i>';
		}

var mangiare_marker = L.icon({
		iconUrl: 'images/markers/mangiare.png',
		iconSize: [18, 26],
		iconAnchor: [10, 10],
		popupAnchor: [0, -28]
	});
var dormire_marker = L.icon({
		iconUrl: 'images/markers/dormire.png',
		iconSize: [24, 28],
		iconAnchor: [10, 10],
		popupAnchor: [0, -28]
	});
var comprare_marker = L.icon({
		iconUrl: 'images/markers/comprare.png',
		iconSize: [18, 22],
		iconAnchor: [10, 10],
		popupAnchor: [0, -28]
	});

    var layer_mangiare = new L.geoJson(json_mangiare, {
		onEachFeature: layer_events,
		pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {icon: mangiare_marker}
			)}
	 });

    var layer_dormire_1 = new L.geoJson(json_dormire_1, {
		onEachFeature: layer_events,
		pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {icon: dormire_marker}
			)}
	});

    var layer_comprare_2 = new L.geoJson(json_comprare_2, {
		onEachFeature: layer_events,
		pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {icon: comprare_marker}
			)}
	});

    var layer_percorso_01 = new L.geoJson(json_1AmeliaSantaMaddalena, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_02 = new L.geoJson(json_2AmerianTrail2017, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_03 = new L.geoJson(json_3AnelloAlvianoMadonnadelPorto, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_04 = new L.geoJson(json_4GiroCavallerizzaMassano, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_05 = new L.geoJson(json_5GirodelParcoEnergiaRinnovabile, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_06 = new L.geoJson(json_6AnelloAlvianoGuardea, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_07 = new L.geoJson(json_7AnellolungodiCollicello, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_08 = new L.geoJson(json_8AnellocortodiFarnetta, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_09 = new L.geoJson(json_9AnellolungodiFarnetta, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_10 = new L.geoJson(json_10AnellodiMelezzole, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_11 = new L.geoJson(json_11AnellodiMontecchio, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_12 = new L.geoJson(json_12AnelloMacchieFelceto, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_13 = new L.geoJson(json_13AnelloMacchieSantaRestituta, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_14 = new L.geoJson(json_14AnelloSantaRestitutaMontePianicelGrande, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_15 = new L.geoJson(json_15AnelloCavallerizzaRoccoBasso, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_16 = new L.geoJson(json_16AnelloCollicelloCapodiSopra, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_17 = new L.geoJson(json_17AnelloAmeliaAspreta, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_18 = new L.geoJson(json_18GirodeiBoschiAmerini, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_19 = new L.geoJson(json_19GirodeiColliAmerini, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_20 = new L.geoJson(json_20GirodelleFrazioni, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_21 = new L.geoJson(json_21AnelloLagoVecchioLaCavallerizza, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_22 = new L.geoJson(json_22AnellodellaCavallerizza, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_23 = new L.geoJson(json_23AnelloMacchieRoccoBasso, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_24 = new L.geoJson(json_24AnellodelRioGrande, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_25 = new L.geoJson(json_25GrandeAnelloAmerino, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_26 = new L.geoJson(json_26AnelloMacchiePiandiNappa, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_27 = new L.geoJson(json_27PasseggiataAmeriantrail, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_28 = new L.geoJson(json_28PasseggiatadellaCavallerizza, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_29 = new L.geoJson(json_29TrekkingUrbanoAmelia2017, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_30 = new L.geoJson(json_30PennaSolfatara, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_31 = new L.geoJson(json_31PennaVallicelle, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_32 = new L.geoJson(json_32AnelloSambucetoleSismano, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_33 = new L.geoJson(json_33SentierodiPalliccio, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_34 = new L.geoJson(json_34LugnanoRamici, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_35 = new L.geoJson(json_35SentierodellaGrottadelVento, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_36 = new L.geoJson(json_36SentierodiPiandellaSelva, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_37 = new L.geoJson(json_37SentierodiSBrunone, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);
    var layer_percorso_38 = new L.geoJson(json_38TourdellAmerino, {
		onEachFeature: layer_events,
		style: style_percorsi}
		);

var overLayers = [
{
	group: "Aktivität",
	collapsed: true,
	layers: [
	{
		name: "Gastronomie",
		icon: iconByName('mangiare'),
		layer: layer_mangiare
	},
	{
		name: "Unterkünfte",
		icon: iconByName('dormire'),
		layer: layer_dormire_1
	},
	{
		name: "Einkauf",
		icon: iconByName('comprare'),
		layer: layer_comprare_2
	}
	]
},
{
	group: "Trails",
	collapsed: true,
	layers: [
	{
		name: "#1 Amelia Strada Santa Maddalena",
		icon: iconByName('percorsi'),
		layer: layer_percorso_01
	},
	{
		name: "#2 Amerian Trail 2017",
		icon: iconByName('percorsi'),
		layer: layer_percorso_02
	},
	{
		name: "#3 Alviano Madonna del Porto",
		icon: iconByName('percorsi'),
		layer: layer_percorso_03
	},
	{
		name: "#4 Cavallerizza Massano",
		icon: iconByName('percorsi'),
		layer: layer_percorso_04
	},
	{
		name: "#5 Giro del Parco Energie",
		icon: iconByName('percorsi'),
		layer: layer_percorso_05
	},
	{
		name: "#6 Alviano Guardea",
		icon: iconByName('percorsi'),
		layer: layer_percorso_06
	},
	{
		name: "#7 Anello di Collicello",
		icon: iconByName('percorsi'),
		layer: layer_percorso_07
	},
	{
		name: "#8 Giro corto di Farnetta",
		icon: iconByName('percorsi'),
		layer: layer_percorso_08
	},
	{
		name: "#9 Giro lungo di Farnetta",
		icon: iconByName('percorsi'),
		layer: layer_percorso_09
	},
	{
		name: "#10 Anello di Melezzole",
		icon: iconByName('percorsi'),
		layer: layer_percorso_10
	},
	{
		name: "#11 Anello di Montecchio",
		icon: iconByName('percorsi'),
		layer: layer_percorso_11
	},
	{
		name: "#12 Giro Macchie Felceto",
		icon: iconByName('percorsi'),
		layer: layer_percorso_12
	},
	{
		name: "#13 Macchie S.Restituta",
		icon: iconByName('percorsi'),
		layer: layer_percorso_13
	},
	{
		name: "#14 Santa Restituta Pianicel Grande",
		icon: iconByName('percorsi'),
		layer: layer_percorso_14
	},
	{
		name: "#15 Cavallerizza Rocco Basso",
		icon: iconByName('percorsi'),
		layer: layer_percorso_15
	},
	{
		name: "#16 Collicello Capo di Sopra",
		icon: iconByName('percorsi'),
		layer: layer_percorso_16
	},
	{
		name: "#17 Giro Aspreta",
		icon: iconByName('percorsi'),
		layer: layer_percorso_17
	},
	{
		name: "#18 Giro dei Boschi Amerini",
		icon: iconByName('percorsi'),
		layer: layer_percorso_18
	},
	{
		name: "#19 Giro dei Colli Amerini",
		icon: iconByName('percorsi'),
		layer: layer_percorso_19
	},
	{
		name: "#20 Giro delle Frazioni",
		icon: iconByName('percorsi'),
		layer: layer_percorso_20
	},
	{
		name: "#21 Lago Vecchio Cavallerizza",
		icon: iconByName('percorsi'),
		layer: layer_percorso_21
	},
	{
		name: "#22 Lago Massano",
		icon: iconByName('percorsi'),
		layer: layer_percorso_22
	},
	{
		name: "#23 Macchie Rocco Basso",
		icon: iconByName('percorsi'),
		layer: layer_percorso_23
	},
	{
		name: "#24 Giro Rio Grande",
		icon: iconByName('percorsi'),
		layer: layer_percorso_24
	},
	{
		name: "#25 Grande Anello Amerino",
		icon: iconByName('percorsi'),
		layer: layer_percorso_25
	},
	{
		name: "#26 Macchie Pian di Nappa",
		icon: iconByName('percorsi'),
		layer: layer_percorso_26
	},
	{
		name: "#27 Passeggiata Amerian Trail",
		icon: iconByName('percorsi'),
		layer: layer_percorso_27
	},
	{
		name: "#28 Passeggiata della Cavallerizza",
		icon: iconByName('percorsi'),
		layer: layer_percorso_28
	},
	{
		name: "#29 Passeggiata Ciclopica",
		icon: iconByName('percorsi'),
		layer: layer_percorso_29
	},
	{
		name: "#30 Penna La Solfatara",
		icon: iconByName('percorsi'),
		layer: layer_percorso_30
	},
	{
		name: "#31 Penna Vallicelle",
		icon: iconByName('percorsi'),
		layer: layer_percorso_31
	},
	{
		name: "#32 Sambucetole Sismano",
		icon: iconByName('percorsi'),
		layer: layer_percorso_32
	},
	{
		name: "#33 Sentiero di Palliccio",
		icon: iconByName('percorsi'),
		layer: layer_percorso_33
	},
	{
		name: "#34 Sentiero di Ramici",
		icon: iconByName('percorsi'),
		layer: layer_percorso_34 
	},
	{
		name: "#35 Sentiero Grotta del Vento",
		icon: iconByName('percorsi'),
		layer: layer_percorso_35
	},
	{
		name: "#36 Sentiero Pian della Selva",
		icon: iconByName('percorsi'),
		layer: layer_percorso_36
	},
	{
		name: "#37 Sentiero S. Brunone",
		icon: iconByName('percorsi'),
		layer: layer_percorso_37
	},
	{
		name: "#38 Tour dell'Amerino",
		icon: iconByName('percorsi'),
		layer: layer_percorso_38
	},
	]}
];

var baseLayers = [
	{
		group: "Base Map",
		collapsed: true,
		layers: [
			{
				name: "OpenStreetMap",
				layer: osmLayer
			},
			{
				name: "Thunderforest Landscape",
				layer: basemap0
			}
		]
	}
];

var panelLayers = new L.Control.PanelLayers(baseLayers, overLayers, {
	collapsibleGroups: true,
	collapsed: true
});

map.addControl(panelLayers);
setBounds();

</script>
</body>
</html>
